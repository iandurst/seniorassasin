<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1">
<title>PCS Senior Assasin — Admin</title><link rel=stylesheet href="/assets/css/styles.css"></head>
<body><div class=nav><div class=wrap><div class=brand><span>PCS Senior Assasin</span></div>
<div class=navlinks><a href="/index.html">Home</a><a href="/rules.html">Rules</a><a href="/vote.html">Vote</a><a href="/signup.html">Sign up</a></div></div></div>
<div class=container><h1>Admin</h1>
<div class=card id=login><p class=small>Enter the admin password to manage the game.</p><form id=loginForm><input id=secret type=password placeholder="••••••••"><button>Unlock</button></form></div>
<div id=panel style="display:none">
  <div class=card><button id=refresh>Refresh</button> <span class=small id=totals>—</span>
    <table class=table><thead><tr><th>Name</th><th>Elims</th><th>Status</th></tr></thead><tbody id=adminList></tbody></table>
  </div>
  <div class=card><h2>Game settings</h2>
    <div><label>Entry fee</label> <input id=entryFee type=number min=0 step=1></div>
    <div><label>Prize override</label> <input id=prizeOverride type=number min=0 step=1></div>
    <button id=saveSettings>Save</button> <button id=startWeek>Start new week & send targets</button>
  </div>
</div>
</div>
<script src="/assets/js/common.js"></script>
<script>
const loginForm=document.getElementById('loginForm'); const panel=document.getElementById('panel');
loginForm.addEventListener('submit', async (e)=>{e.preventDefault(); const s=document.getElementById('secret').value.trim(); localStorage.setItem('pcs_admin_secret',s);
 try{ await api('/verify-admin',{method:'POST',headers:adminHeaders()}); document.getElementById('login').style.display='none'; panel.style.display='block'; loadState(); }
 catch{ localStorage.removeItem('pcs_admin_secret'); alert('Incorrect password') }
});
async function loadState(){ const s=await api('/get-state'); document.getElementById('totals').textContent=`${s.participants.filter(p=>p.status==='active'&&p.alive).length} alive / ${s.participants.filter(p=>p.status==='active').length} active`;
 const t=document.getElementById('adminList'); t.innerHTML=''; s.participants.filter(p=>p.status==='active').sort((a,b)=>a.lastName.localeCompare(b.lastName)).forEach(p=>{
  const tr=document.createElement('tr'); tr.innerHTML=`<td>${p.firstName} ${p.lastName}</td><td>${p.eliminations}</td><td>
  <select data-id="${p.id}"><option value="true" ${p.alive?'selected':''}>Alive</option><option value="false" ${!p.alive?'selected':''}>Out</option></select></td>`; t.appendChild(tr);
 });
 t.querySelectorAll('select').forEach(sel=>sel.addEventListener('change',async(e)=>{const id=e.target.getAttribute('data-id'); const alive=e.target.value==='true';
  try{ await api('/update-participant',{method:'POST',headers:adminHeaders(),body:JSON.stringify({id,alive})}); }catch(err){ alert(err.data?.error||'Update failed') }
 }));
 document.getElementById('entryFee').value=s.settings.entryFee||5; document.getElementById('prizeOverride').value=s.settings.prizePoolOverride??'';
}
document.getElementById('refresh').addEventListener('click', loadState);
document.getElementById('saveSettings').addEventListener('click', async()=>{
 const entryFee=Number(document.getElementById('entryFee').value||0); const prize=document.getElementById('prizeOverride').value===''?null:Number(document.getElementById('prizeOverride').value);
 try{ await api('/set-settings',{method:'POST',headers:adminHeaders(),body:JSON.stringify({entryFee,prizePoolOverride:prize})}); alert('Saved'); loadState(); }catch(err){ alert(err.data?.error||'Save failed') }
});
document.getElementById('startWeek').addEventListener('click', async()=>{
 if(!confirm('Start new week & text targets?')) return;
 try{ const res=await api('/start-week',{method:'POST',headers:adminHeaders()}); alert('Week started'); }catch(err){ alert(err.data?.error||'Failed') }
});
</script></body></html>